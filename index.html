<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ุชุทุจูู Keey</title>
    
    <link rel="manifest" href="manifest.json">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <link rel="stylesheet" href="style.css">

    <script>
        // ูุชุบูุฑ ูุญูุธ ุญุฏุซ ุงูุชุซุจูุช
        let deferredPrompt;

        // 1. ุงูุชูุงุท ุงูุญุฏุซ ูุจู ุธููุฑู
        window.addEventListener('beforeinstallprompt', (e) => {
            // ููุน ุธููุฑ ูุงูุฐุฉ ุงููุฑูู ุงูุตุบูุฑุฉ ููุฑุงู
            e.preventDefault();
            // ุญูุธ ุงูุญุฏุซ ูุงุณุชุฎุฏุงูู ูุงุญูุงู
            deferredPrompt = e;
            console.log('โ ุชู ุงูุชูุงุท ุญุฏุซ ุงูุชุซุจูุช ุฌุงูุฒ ููุฅุทูุงู');
            
            // ุฅุธูุงุฑ ูุงูุฐุชู ุงูุฎุงุตุฉ
            const banner = document.getElementById('installBanner');
            if (banner) banner.style.display = 'flex';
        });

        // 2. ูุธููุฉ ุฒุฑ ุงูุชุซุจูุช (ูุฏูุฌุฉ ููุง ูุถูุงู ุงูุนูู)
        document.addEventListener('DOMContentLoaded', () => {
            const btn = document.getElementById('installBtn');
            if(btn) {
                btn.addEventListener('click', async () => {
                    if (deferredPrompt) {
                        // ุฅุทูุงู ูุงูุฐุฉ ุงูุชุซุจูุช ุงูุฃุตููุฉ
                        deferredPrompt.prompt();
                        // ุงูุชุธุงุฑ ุฑุฏ ุงููุณุชุฎุฏู
                        const { outcome } = await deferredPrompt.userChoice;
                        console.log(`User response: ${outcome}`);
                        // ุชุตููุฑ ุงููุชุบูุฑ
                        deferredPrompt = null;
                        // ุฅุฎูุงุก ุงูุจุงูุฑ ุงูุฎุงุต
                        document.getElementById('installBanner').style.display = 'none';
                    } else {
                        console.log('โ ุญุฏุซ ุงูุชุซุจูุช ุบูุฑ ูุชููุฑ ุญุงููุงู');
                        alert('ุงูุชุซุจูุช ุบูุฑ ูุชุงุญ ุญุงููุงูุ ุฑุจูุง ุงูุชุทุจูู ูุซุจุช ุจุงููุนูุ');
                    }
                });
            }
        });

        // 3. ุชุณุฌูู Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('SW Registered'))
                .catch(err => console.log('SW Error', err));
            });
        }
    </script>
    <style>
        /* ุฅุถุงูุฉ ุตุบูุฑุฉ ูุนูุงูุฉ ุงูุฅุดุนุงุฑุงุช */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: red;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: none; /* ูุฎูู ุงูุชุฑุงุถูุงู */
            justify-content: center;
            align-items: center;
            border: 2px solid var(--primary);
        }
    </style>
</head>
<body>

    <div id="storeWarningModal" class="modal-overlay">
        <div class="modal-content" style="border: 2px solid red;">
            <div style="font-size:3rem; margin-bottom:10px;">โ๏ธ</div>
            <h3 style="color:red;">ุชุญุฐูุฑ ูุงู</h3>
            <p style="text-align:right; font-size:0.9rem; line-height:1.6;">
                ุฃู ุชูุงุนุจ ุนูู ุงูุดุฑูุฉ ูุงููุชุฌุฑ ูู ุงูุดุฑุงุก ุญุชู ุฅู ูุงู ูู ุญุณุงุจ ุขุฎุฑ ุณูุชู ุญุธุฑ ุฌููุน ุญุณุงุจุงุช ูุงุชูู ุจุงููุงูู.
                <br> ูุชู ุญูุธ ูุนูููุงุช ุงูุญุณุงุจ ุนุจุฑ GPS.
                <br> ูุชููู ุฃู ุชููู ุนุถู ุงุณุชุซูุงุฑู ูุณุงุนุฏ ุนูู ุงูุชุทููุฑ ุงูุฐุงุชู.
            </p>
            <label style="display:block; margin:15px 0;">
                <input type="checkbox" id="dontShowStoreWarn"> ูุง ุชุธูุฑ ูู ูุฐู ุงูุฑุณุงูุฉ ูุฌุฏุฏุงู
            </label>
            <button onclick="acceptStoreWarning()" style="background:var(--primary);">ููุงูู ููุชุงุจุนุฉ</button>
        </div>
    </div>

    <div id="purchasesModal" class="modal-overlay">
        <div class="modal-content" style="height: 80%; display: flex; flex-direction: column;">
            <h3>ุณุฌู ุงููุดุชุฑูุงุช</h3>
            <div id="purchasesList" style="flex:1; overflow-y: auto; text-align: right; margin-top:10px;">
                </div>
            <button onclick="document.getElementById('purchasesModal').style.display='none'" style="background:#555; margin-top:10px;">ุฅุบูุงู</button>
        </div>
    </div>

    <div id="installBanner" class="install-modal" style="display: none;">
        <div class="install-content">
            <div class="install-icon"><img src="https://e.top4top.io/p_3669xvp3m1.jpg" style="width:60px; border-radius:10px;"></div>
            <h3>ุชุซุจูุช ุชุทุจูู Keey</h3>
            <p>ูุชุฌุฑุจุฉ ุฃูุถู ูุณุฑุนุฉ ุฃุนููุ ูู ุจุชุซุจูุช ุงูุชุทุจูู ุนูู ุฌูุงุฒู.</p>
            <button id="installBtn" class="install-btn">ุชุซุจูุช ุงูุขู</button>
            <button onclick="document.getElementById('installBanner').style.display='none'" class="skip-install-btn">ุชุฎุทู</button>
        </div>
    </div>

    <div id="customAlert" class="custom-alert-overlay">
        <div class="custom-alert-box">
            <i class="alert-icon" id="alertIcon">โ๏ธ</i>
            <h3 id="alertTitle">ุชูุจูู</h3>
            <p id="alertMsg">ูุต ุงูุฑุณุงูุฉ</p>
            <button class="alert-btn" onclick="closeCustomAlert()">ุญุณูุงู</button>
        </div>
    </div>

    <div id="withdrawModal" class="modal-overlay">
        <div class="modal-content" style="text-align: right;">
            <h3 style="text-align: center; margin-bottom: 20px;">ุทูุจ ุณุญุจ ุฃุฑุจุงุญ</h3>
            <p>ุงูุฑุตูุฏ ุงูููู: <span id="wTotalBalance" style="font-weight: bold; color: green;">0</span> IQD</p>
            
            <label style="font-size:0.8rem; color:#666;">ุงูุงุณู ุงูุดุฎุตู (ุงูุซูุงุซู)</label>
            <input type="text" id="wRealName" style="width:100%; padding:10px; margin-bottom:10px;" placeholder="ุงูุชุจ ุงุณูู ุงูุญูููู ููุง">

            <label style="font-size:0.8rem; color:#666;">ุงููุจูุบ</label>
            <input type="number" id="wAmount" style="width:100%; padding:10px; margin-bottom:10px;" placeholder="ุฃูู ูุจูุบ 7000">
            
            <label style="font-size:0.8rem; color:#666;">ุทุฑููุฉ ุงูุณุญุจ</label>
            <select id="wMethod" style="width:100%; padding:10px; margin-bottom:10px;">
                <option value="zaincash">ุฒูู ูุงุด (ZainCash)</option>
                <option value="mastercard">ูุงุณุชุฑ ูุงุฑุฏ (MasterCard)</option>
                <option value="fib">FIB</option>
                <option value="usdt">USDT (TRC20)</option>
            </select>
            
            <label style="font-size:0.8rem; color:#666;">ุฑูู ุงูุญุณุงุจ / ุงููุญูุธุฉ</label>
            <input type="text" id="wAccount" style="width:100%; padding:10px; margin-bottom:20px;" placeholder="ุงูุชุจ ุงูุฑูู ุฃู ุงูุนููุงู ููุง">
            
            <button onclick="submitWithdrawRequest()" style="background:var(--primary); width:100%;">ุชุฃููุฏ ุงูุณุญุจ</button>
            <button onclick="document.getElementById('withdrawModal').style.display='none'" style="background:#555; width:100%; margin-top:10px;">ุฅูุบุงุก</button>
        </div>
    </div>

    <div id="supportModal" class="modal-overlay">
        <div class="modal-content" style="height: 80%; display: flex; flex-direction: column;">
            <div style="flex:1; overflow-y: auto; text-align: right; padding: 10px; background: #f9f9f9; border-radius: 10px; margin-bottom: 10px;" id="chatHistory">
                <p style="text-align:center; color:#999; font-size:0.8rem;">ูุฑุญุจุงู ุจู ูู ุงูุฏุนู ุงูููู</p>
            </div>
            <div style="display:flex; gap:5px;">
                <input type="text" id="supportMsgInput" style="flex:1; padding:10px; border-radius:5px; border:1px solid #ddd;" placeholder="ุงูุชุจ ุฑุณุงูุชู...">
                <button onclick="sendSupportMessage()" style="width:auto; padding:0 20px;"><i class="fas fa-paper-plane"></i></button>
            </div>
            <button onclick="document.getElementById('supportModal').style.display='none'" style="background:#555; margin-top:10px;">ุฅุบูุงู</button>
        </div>
    </div>

    <div id="loginModal" class="modal-overlay">
        <div class="modal-content">
            <div style="font-size:3rem; margin-bottom:10px;">๐</div>
            <h2>ุฃููุงู ุจู ูู Keey</h2>
            <p>ุณุฌู ุงูุฏุฎูู ูุญูุธ ุจูุงูุงุชู</p>
            <button onclick="loginGoogle()" class="google-btn"><i class="fab fa-google"></i> ุฏุฎูู ุนุจุฑ Google</button>
            <button onclick="loginGuest()" class="skip-btn">ุฏุฎูู ูุฒุงุฆุฑ</button>
        </div>
    </div>

    <div class="app-header">
        <div class="user-info-header">
            <div class="avatar-circle"><i class="fas fa-user-astronaut"></i></div>
            <div>
                <span id="headerName" style="font-weight:bold;">ุฒุงุฆุฑ</span>
                <span style="font-size:0.7rem; display:block; opacity:0.8;">ID: <span id="userId">---</span></span>
            </div>
        </div>
        <div class="header-actions" style="position: relative;">
            <i class="fas fa-bell" onclick="showMsg('ุงูุฅุดุนุงุฑุงุช', 'ุชูุถู ุจูุฑุงุฌุนุฉ ูุณู ุงูุฏุนู ุงูููู.', '๐')"></i>
            <span id="notifBadge" class="notification-badge">!</span>
            <i class="fas fa-headset" onclick="openSupportChat()" style="margin-right: 15px;"></i>
        </div>
    </div>

    <main class="content-area">
        
        <section id="home" class="tab-content active">
            <div class="balance-card gsap-fade">
                <h3>ุงูุฑุตูุฏ ุงูููู</h3>
                <h1 id="walletBalance">0 IQD</h1>
                
                <div class="daily-counter-box">
                    <p>ุงูุฑุจุญ ุงููููู ุงูููู: <span id="totalDailyProfit" style="color:#f1c40f; font-weight:bold;">0</span> IQD</p>
                    
                    <div class="master-card-container">
                        <div class="master-card-bg">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/Mastercard-logo.svg/1280px-Mastercard-logo.svg.png" style="width: 60%; opacity: 0.8;">
                            <div style="position:absolute; bottom:10px; left:10px; color:white; font-family:monospace;">**** **** **** 1234</div>
                        </div>
                        <div class="master-card-overlay" id="cardOverlay"></div> </div>
                    <div class="timer-anim" style="margin-top:10px;">
                        <span id="dailyTimer">00:00:00</span>
                    </div>

                    <button id="startMiningBtn" onclick="manualClaimAndStart()" style="display:none; background:#27ae60; margin-top:10px; animation: pulse 1.5s infinite;">
                        โก ุฌูุน ุงูุฃุฑุจุงุญ ูุชุดุบูู ุงูุนุฏุงุฏ
                    </button>
                </div>

                <div class="quick-actions">
                    <button onclick="showMsg('ูุฏูุฉ', 'ูุฑูุจุงู..', '๐')" class="action-icon"><i class="fas fa-gift"></i> ูุฏูุฉ</button>
                    <button onclick="showMsg('ุงูุญุธ', 'ูุฑูุจุงู..', '๐ก')" class="action-icon"><i class="fas fa-dharmachakra"></i> ุงูุญุธ</button>
                </div>
            </div>

            <div class="plans-container">
                <h2 style="color:var(--primary); margin-bottom:15px;">ุจุงูุงุช ุงูุงุณุชุซูุงุฑ</h2>
                <div id="dynamicPlansArea">
                    <p style="text-align:center; padding:20px;">ุฌุงุฑู ุชุญููู ุงูุจุงูุงุช...</p>
                </div>
            </div>
        </section>

        <section id="team" class="tab-content">
            <div style="padding:20px;">
                <h2 style="color:var(--primary);">ุฅุฏุงุฑุฉ ุงููุฑูู</h2>
                
                <div class="invite-card">
                    <i class="fas fa-crown" style="font-size:2rem; color:gold; margin-bottom:10px;"></i>
                    <h3>ุญุงูุฉ ุงููุฑูู</h3>
                    <div style="font-size:2.5rem; font-weight:bold; color:var(--primary);" id="activeTeamCounter">0/10</div>
                    <p style="font-size:0.9rem; color:#666;">ุงูุฃุนุถุงุก ุงููุดุทูู ููุท</p>
                    
                    <div style="background:#f9f9f9; padding:10px; border-radius:10px; margin-top:15px; border:1px dashed var(--primary);">
                        <p style="font-size:0.8rem; margin:0;">ุงุญุตู ุนูู 5% (5,000 IQD ุชูุฑูุจุงู) ุนู ูู ุนุถู ูููู ุจุชูุนูู ุนุฏุงุฏ.</p>
                        <p style="font-size:0.8rem; margin:5px 0 0 0; color:red;">ุงูุญุฏ ุงูุฃูุตู 10 ุฃุนุถุงุก ูุดุทูู</p>
                    </div>
                </div>

                <div class="invite-card" style="margin-top:10px;">
                    <h3>ููุฏ ุงูุฏุนูุฉ ุงูุฎุงุต ุจู</h3>
                    <div class="invite-link-text" id="myInviteCode">LOADING...</div>
                    <button onclick="copyInviteLink()">ูุณุฎ ุงูููุฏ</button>
                </div>

                <div style="display:flex; justify-content:space-between; margin-top:20px;">
                    <div style="text-align:center; flex:1;"><h4>ุฃุฑุจุงุญ ุงููุฑูู</h4><h2 style="color:green" id="teamEarnings">0</h2></div>
                </div>
            </div>
        </section>

        <section id="wallet" class="tab-content">
            <div style="padding:20px;">
                <h2 style="color:var(--primary);">ุงููุญูุธุฉ</h2>
                <div class="balance-card" style="margin:0;">
                    <p>ุงูุฑุตูุฏ ุงููุชุงุญ</p>
                    <h1 id="walletBalance2">0 IQD</h1>
                    <div class="quick-actions">
                        <button onclick="showDepositInfo()" style="background:#fff; color:#333;"><i class="fas fa-plus"></i> ุฅูุฏุงุน</button>
                        <button onclick="showWithdraw()" style="background:#fff; color:#333;"><i class="fas fa-arrow-down"></i> ุณุญุจ</button>
                    </div>
                </div>
                <h3 style="margin-top:20px;">ุณุฌู ุงูุนูููุงุช</h3>
                <ul id="transList" style="list-style:none; padding:0;">
                    <li style="color:#777; text-align:center;">ุฌุงุฑู ุชุญููู ุงูุนูููุงุช...</li>
                </ul>
            </div>
        </section>

        <section id="store" class="tab-content">
            <div style="padding:20px;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <h2 style="color:var(--primary); margin:0;">ุงููุชุฌุฑ</h2>
                    <button onclick="openPurchases()" style="width:auto; background:var(--accent); font-size:0.8rem;">๐ฆ ุงููุดุชุฑูุงุช</button>
                </div>
                
                <div id="userStoreCategories" class="store-categories-container">
                    </div>

                <div id="userStoreProducts" style="margin-top:20px;">
                    <p style="text-align:center; color:#777;">ุงุฎุชุฑ ุชุตูููุงู ูุนุฑุถ ุงูููุชุฌุงุช</p>
                </div>
            </div>
        </section>

        <section id="profile" class="tab-content">
            <div style="padding:20px;">
                <h2 style="color:var(--primary);">ุญุณุงุจู</h2>
                
                <div style="background:white; padding:15px; border-radius:15px; margin-bottom:20px; box-shadow:0 3px 10px rgba(0,0,0,0.05);">
                    <h4 style="margin-top:0;">ูู ุงูุฐู ุฏุนุงูุ</h4>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="inviterCodeInput" placeholder="ุฃุฏุฎู ููุฏ ุตุฏููู ููุง" style="flex:1; padding:8px; border:1px solid #ddd; border-radius:5px;">
                        <button onclick="saveInviteCode()" style="width:auto; background:var(--accent);">ุชุฃููุฏ</button>
                    </div>
                    <p style="font-size:0.75rem; color:#777; margin-bottom:0;">ุงุฎุชูุงุฑู: ุฃุฏุฎู ููุฏ ุงููุงุฆุฏ ููุงูุถูุงู ููุฑููู.</p>
                </div>

                <div class="telegram-group">
                    <a href="https://t.me/keey1001" target="_blank" class="telegram-btn tg-channel">ุงูููุงุฉ</a>
                    <a href="https://t.me/keey1001" target="_blank" class="telegram-btn tg-chat">ุงูุฏุฑุฏุดุฉ</a>
                </div>
                <div class="menu-list">
                    <div class="menu-item" onclick="logout()"><i class="fas fa-sign-out-alt" style="color:red"></i> ุฎุฑูุฌ</div>
                </div>
                <h3>ุณุฌู ุงูุงุดุชุฑุงูุงุช ุงููุดุทุฉ</h3>
                <ul id="myPlansList" style="padding:0; list-style:none;">
                    </ul>
            </div>
        </section>

    </main>

    <nav class="bottom-nav">
        <div class="nav-item" onclick="switchTab('profile')"><i class="fas fa-user"></i> <span>ุญุณุงุจู</span></div>
        <div class="nav-item" onclick="switchTab('team')"><i class="fas fa-users"></i> <span>ุงููุฑูู</span></div>
        <div class="nav-item center-btn active" onclick="switchTab('home')"><div class="floating-home"><i class="fas fa-home"></i></div></div>
        <div class="nav-item" onclick="switchTab('store')"><i class="fas fa-store"></i> <span>ุงููุชุฌุฑ</span></div>
        <div class="nav-item" onclick="switchTab('wallet')"><i class="fas fa-wallet"></i> <span>ุงููุญูุธุฉ</span></div>
    </nav>

    <script src="script.js" type="module"></script>
</body>
</html>
